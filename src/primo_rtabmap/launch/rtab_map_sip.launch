<?xml version="1.0"?>
<launch>

    <node ns="stereo1/" pkg="nodelet" type="nodelet" name="disparity2depth" 
        args="standalone rtabmap_ros/disparity_to_depth"/>

    <arg name="rgb_topic"               value="/stereo1/left/image_rect_color"/>
    <arg name="depth_registered_topic"  value="/stereo1/depth"/>
    <arg name="camera_info_topic"       value="/stereo1/left/camera_info"/>
    <arg name="frame_id"                value="base_link"/>
    <arg name="compressed"              value="false"/>

    <node name="rtabmap" pkg="rtabmap_ros" type="rtabmap" output="screen" args="--delete_db_on_start">
		<param name="subscribe_stereo"      type="bool"     value="false"/>
		<param name="subscribe_depth"       type="bool"     value="true"/>
		<param name="stereo_approx_sync"    type="bool"     value="true"/>

        <remap from="odom" to="/odom"/>
        <param name="frame_id"              type="string"   value="base_link"/>

        <remap from="rgb/image"         to="/stereo1/left/image_rect_color"/>
        <remap from="depth/image"       to="/stereo1/depth"/>
        <remap from="rgb/camera_info"   to="/stereo1/left/camera_info"/>

		

		<param name="queue_size"            type="int"      value="30"/>

        <!-- all points below 20 cm are ground -->
        <param name="Grid/MaxGroundHeight"  type="string"   value="0.5"/>       

        <!-- all points above 20 cm and below 2 m are obstacles -->
        <!-- <param name="Grid/MaxObstacleHeight" type="string" value="3"/>        -->

        <!-- Use simple passthrough to filter the ground instead of normals segmentation -->
        <!-- <param name="Grid/NormalsSegmentation" type="string" value="false"/>  -->

	    <!-- RTAB-Map's parameters -->
	    <param name="Rtabmap/TimeThr"               type="string"   value="700"/>
	    <param name="Rtabmap/DetectionRate"         type="string"   value="1"/>
	    <param name="Kp/WordsPerImage"              type="string"   value="200"/>
	    <param name="Kp/RoiRatios"                  type="string"   value="0.03 0.03 0.04 0.04"/>
	    <param name="Kp/DetectorStrategy"           type="string"   value="0"/>
	    <!-- use SURF -->
	    <param name="Kp/NNStrategy"                 type="string"   value="1"/>
	    <!-- kdTree -->
	    <param name="SURF/HessianThreshold"         type="string"   value="1000"/>
	    <param name="LccBow/MinInliers"             type="string"   value="10"/>
	    <param name="LccBow/EstimationType"         type="string"   value="1"/>
	    <!-- 3D->2D (PnP) -->
	    <param name="LccReextract/Activated"        type="string"   value="true"/>
	    <param name="LccReextract/MaxWords"         type="string"   value="500"/>
        <param name="RGBD/OptimizeFromGraphEnd"     type="string"   value="true"/>
	    <param name="cloud_floor_culling_height"    value="0.18"/>

		<param name="Vis/MinInliers"                type="string"   value="10"/>
		<param name="Vis/InlierDistance"            type="string"   value="0.1"/>

        <!-- http://bit.ly/2wdXVtj -->
		<param name="Vis/EstimationType"            type="int"      value="1"/>

        <!-- Adding a despeckler -->
        <param name="StereoBM/SpeckleWindowSize"    type="int"      value="1000"/>
        <param name="StereoBM/TextureThreshold"     type="int"      value="300"/>

	  </node>
</launch>
