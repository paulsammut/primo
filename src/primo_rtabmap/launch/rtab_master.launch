<?xml version="1.0"?>
<launch>

    <arg name="rviz"        default="false"/>
    <arg name="rtabmapviz"  default="false"/>
    <arg name="rgbd"        default="true"/>
    <arg name="stereo"      default="false"/>
    <arg name="odom_topic"  default="odom"/>

    <include file="$(find primo_rtabmap)/launch/rtab_init.launch"/>


    <!-- Visualization in rtabmap_viz -->
    <group if="$(arg rtabmapviz)">
        <include file="$(find primo_rtabmap)/launch/rtab_viz.launch">
            <arg name="rviz"                value="$(arg rviz)"/>
            <arg name="rtab_viz_stereo"     value="$(arg stereo)"/>
            <arg name="rtab_viz_rgbd"       value="$(arg rgbd)"/>
            <arg name="odom_topic"          value="$(arg odom_topic)"/>

        </include>
    </group>

    <!-- rtabmap paramateres which are commom for either stereo or rbgd -->
    <group ns="rtabmap">
        <param name="Grid/CellSize"             type="double"   value="0.02"/>
        <param name="GridGlobal/MinSize"        type="double"   value="10"/>
        <param name="Grid/MaxGroundHeight"      type="string"   value="0.50"/>       
        <param name="Grid/MaxGroundAngle"       type="double"   value="45"/>
        <param name="Grid/MaxObstacleHeight"    type="double"   value="2"/>
        <param name="Grid/MinClusterSize"       type="int"      value="20"/>
        <param name="Grid/DepthMax"             type="double"   value="4"/>

        <!-- RTAB-Map's parameters -->
        <param name="Rtabmap/TimeThr"                   type="string"   value="1200"/>
        <param name="Rtabmap/DetectionRate"             type="string"   value="3"/>
        <param name="Kp/MaxFeatures"                    type="string"   value="200"/>
        <param name="Kp/RoiRatios"                      type="string"   value="0.03 0.03 0.04 0.04"/>
        <param name="Kp/DetectorStrategy"               type="string"   value="0"/>
        <!-- use SURF -->
        <param name="Kp/NNStrategy"                     type="string"   value="1"/>
        <!-- kdTree -->
        <param name="SURF/HessianThreshold"             type="string"   value="1000"/>
        <!-- 3D->2D (PnP) -->
        <param name="RGBD/OptimizeMaxError"             type="double"   value="1.0"  />
        <param name="RGBD/OptimizeFromGraphEnd"         type="string"   value="false"/>
        <param name="RGBD/LoopClosureReextractFeatures" type="string"   value="true"/>
        <param name="Grid/MaxGroundHeight"              type="double"   value="0.18"/>

        <param name="Vis/MinInliers"                    type="string"   value="10"/>
        <param name="Vis/InlierDistance"                type="string"   value="0.1"/>
        <param name="Viz/EstimationType"                type="int"      value="1"/>
        <param name="Vis/MaxFeatures"                   type="int"      value="1000"/>

        <!-- Force 2d mode -->
        <param name="Reg/Force3DoF"                                     value="true" />
        <param name="Optimizer/Slam2D"                                  value="true" />
    </group>

    <include if="$(arg stereo)" file="$(find primo_rtabmap)/launch/rtab_map_stereo.launch">
        <arg name="odom_topic"  value="$(arg odom_topic)"/>
    </include>

    <include if="$(arg rgbd)"   file="$(find primo_rtabmap)/launch/rtab_map_rgbd.launch">
        <arg name="odom_topic"  value="$(arg odom_topic)"/>
    </include>


</launch>
