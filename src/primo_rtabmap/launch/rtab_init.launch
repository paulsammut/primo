<?xml version="1.0"?>
<launch>

    <arg name="rviz"            default="false"/>
    <arg name="rtab_viz_stereo" default="false"/>
    <arg name="rtab_viz_rgbd"   default="false"/>

  	<!-- Create a rotated camera link that has the correct rtab reference frame -->
  	<arg name="pi/2" value="" />
  	<node pkg="tf" type="static_transform_publisher" name="stereo1_corrected_link_node"
      args="0 0 0 -1.5707963267948966 0 -1.5707963267948966 stereo1_link stereo1_corrected_link 100"/>
      
    <!-- Visualisation RTAB-Map RGBD -->
    <node if="$(arg rtab_viz_rgbd)" pkg="rtabmap_ros" type="rtabmapviz" name="rtabmapviz" 
      args="-d $(find rtabmap_ros)/launch/config/rgbd_gui.ini" output="screen">

	    <param name="subscribe_rgbd"        type="bool"     value="true"/>
	    <param name="subscribe_stereo"      type="bool"     value="false"/>
	    <param name="subscribe_odom_info"   type="bool"     value="false"/>
        <param name="stereo_approx_sync"    type="bool"     value="true"/>
	    <param name="queue_size"            type="int"      value="10"/>
	    <param name="frame_id"              type="string"   value="base_link"/>

	    <remap from="left/image_rect"       to="/stereo1/left/image_rect_color"/>
	    <remap from="right/image_rect"      to="/stereo1/right/image_rect"/>
	    <remap from="left/camera_info"      to="/stereo1/left/camera_info"/>
	    <remap from="right/camera_info"     to="/stereo1/right/camera_info"/>
	    <remap from="odom_info"             to="/odom_info"/>
	    <remap from="odom"                  to="/odom"/>


	    <remap from="odom"                  to="/odom"/>
        <remap from="rgbd_image"            to="/stereo1/left/image_rect"/>
        <remap from="depth/image"           to="/stereo1/depth"/>
        <remap from="rgb/camera_info"       to="/stereo1/left/camera_info"/>
    </node>
    
    <!-- Visualisation RTAB-Map with a Stereo feed-->
    <node if="$(arg rtab_viz_stereo)" pkg="rtabmap_ros" type="rtabmapviz" name="rtabmapviz" 
      args="-d $(find rtabmap_ros)/launch/config/rgbd_gui.ini" output="screen">

	    <param name="subscribe_stereo"      type="bool"     value="true"/>
	    <param name="subscribe_odom_info"   type="bool"     value="false"/>
        <param name="stereo_approx_sync"    type="bool"     value="true"/>
	    <param name="queue_size"            type="int"      value="10"/>
	    <param name="frame_id"              type="string"   value="base_link"/>

	    <remap from="left/image_rect"       to="/stereo1/left/image_rect_color"/>
	    <remap from="right/image_rect"      to="/stereo1/right/image_rect"/>
	    <remap from="left/camera_info"      to="/stereo1/left/camera_info"/>
	    <remap from="right/camera_info"     to="/stereo1/right/camera_info"/>
	    <remap from="odom_info"             to="/odom_info"/>
	    <remap from="odom"                  to="/odom"/>

    </node>

  	<!-- Visualisation RVIZ -->
    <node if="$(arg rviz)" pkg="rviz" type="rviz" name="rviz" args="-d $(find primo_rtabmap)/rviz/rtabmap.rviz" />

</launch>
