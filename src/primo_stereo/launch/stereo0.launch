<?xml version="1.0" encoding="UTF-8"?>
<launch>

    <node ns="stereo0" pkg="uvc_camera" type="tara_node" name="uvc_camera" output="screen" required="true">
        <param name="width" type="int" value="640"/>
        <param name="height" type="int" value="480"/>
        <param name="fps" type="int" value="30"/>
        <param name="frame" type="string" value="stereo0_link"/>
        <param name="frame_id" type="string" value="stereo0_link"/>
        <param name="device" type="string" value="/dev/video0"/>
        <param name="exposureValue" type="int" value="1"/>

        <param name="cameraLeft_info_url" type="string" value="package://primo_stereo/config/stereo0/left.yaml"/>
        <param name="cameraRight_info_url" type="string" value="package://primo_stereo/config/stereo0/right.yaml"/>
    </node>


    <group ns="/stereo0">
        <arg name="manager" value="/stereo0/nodelet_manager"/>
        <arg name="respawn" value="true"/>
        <arg name="left" value="left" />
        <arg name="right" value="right" />
        
        <node pkg="nodelet" type="nodelet" name="nodelet_manager"  args="manager"/>

        <arg     if="$(arg respawn)" name="bond" value="" />
        <arg unless="$(arg respawn)" name="bond" value="--no-bond" />

        
        <!-- Basic processing for left camera -->
        <!-- Debayered images -->
        <group ns="left">
            <node pkg="nodelet" type="nodelet" name="debayer"
                args="load image_proc/debayer $(arg manager) $(arg bond)"
                respawn="$(arg respawn)" />

            <!-- Monochrome rectified image -->
            <node pkg="nodelet" type="nodelet" name="rectify_mono"
                  args="load image_proc/rectify $(arg manager) $(arg bond)"
              respawn="$(arg respawn)" />

            <!-- Color rectified image -->
            <node pkg="nodelet" type="nodelet" name="rectify_color"
                args="load image_proc/rectify $(arg manager) $(arg bond)"
                respawn="$(arg respawn)">

                <remap from="image_mono" to="image_color" />
                <remap from="image_rect" to="image_rect_color" />
            </node>  
        </group>

        <!-- Basic processing for right camera -->
        <!-- Debayered images -->
        <group ns="right">
            <node pkg="nodelet" type="nodelet" name="debayer"
                args="load image_proc/debayer $(arg manager) $(arg bond)"
                respawn="$(arg respawn)" />

            <!-- Monochrome rectified image -->
            <node pkg="nodelet" type="nodelet" name="rectify_mono"
                  args="load image_proc/rectify $(arg manager) $(arg bond)"
              respawn="$(arg respawn)" />

            <!-- Color rectified image -->
            <node pkg="nodelet" type="nodelet" name="rectify_color"
                args="load image_proc/rectify $(arg manager) $(arg bond)"
                respawn="$(arg respawn)">

                <remap from="image_mono" to="image_color" />
                <remap from="image_rect" to="image_rect_color" />
            </node>  
        </group>
        
        <!-- Disparity image -->
        <node pkg="nodelet" type="nodelet" name="disparity"
            args="load stereo_image_proc/disparity $(arg manager) $(arg bond)"
            respawn="$(arg respawn)" >

            <param name="disparty_rage" value="128"/>
        </node>
        
        <!-- PointCloud2 -->
        <node pkg="nodelet" type="nodelet" name="point_cloud2"
            args="load stereo_image_proc/point_cloud2 $(arg manager) $(arg bond)"
            respawn="$(arg respawn)" />

    </group>
</launch>
