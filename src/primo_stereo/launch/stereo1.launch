<?xml version="1.0" encoding="UTF-8"?>
<launch>

    <arg name="stereo_real" default="true"/>
    <rosparam file="$(find primo_stereo)/config/stereo.yaml" command="load"/>

    <group if="$(arg stereo_real)">
        <node ns="stereo1" pkg="uvc_camera" type="tara_node" name="uvc_camera" output="screen" required="true">
            <param name="width"         type="int"      value="640"             />
            <param name="height"        type="int"      value="480"             />
            <param name="fps"           type="int"      value="30"              />
            <param name="frame"         type="string"   value="stereo1_link"    />
            <param name="frame_id"      type="string"   value="stereo1_link"    />
            <param name="device"        type="string"   value="/dev/video1"     />
            <param name="exposureValue" type="int"      value="1"               />

            <param name="cameraLeft_info_url"   type="string"   value="package://primo_stereo/config/stereo1/left.yaml"/>
            <param name="cameraRight_info_url"  type="string"   value="package://primo_stereo/config/stereo1/right.yaml"/>
        </node>
    </group>

    <group ns="/stereo1">
        <node pkg="nodelet" type="nodelet" name="stereo1_nodelet_manager" args="manager" output="screen"/>

        <include file="$(find stereo_image_proc)/launch/stereo_image_proc.launch">
            <arg name="manager"     value="/stereo1/stereo1_nodelet_manager"/>
        </include>

        <!-- Run a passthrough filter to delimit in x direction -->
        <node pkg="nodelet" type="nodelet" name="psx" args="load pcl/PassThrough stereo1_nodelet_manager" output="screen">
            <remap from="~input" to="/stereo1/points2" />
            <rosparam>
                input_frame: base_link
                filter_field_name: x
                filter_limit_min: -.8
                filter_limit_max: 0.5
            </rosparam>
        </node>
    </group>

    <!-- <node name="record_topics_for_verification" pkg="rosbag" type="record" args="/stereo/left/camera_info /stereo/right/camera_info /stereo/right/image_rect /stereo/left/image_rect" output="screen"/> -->

</launch>
