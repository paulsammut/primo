<?xml version="1.0"?>
<launch>

    <!-- 
         This launch file was used to simulate the wheel encoders to test the updated
         diff_tf 
    -->

    <include file="$(find primo_description)/launch/primo_urdf_sim.launch"/>

    <include file="$(find primo_gazebo)/launch/primo_gazebo.launch">
        <arg name="world"       value="bat_cave.world"/> 
        <arg name="rviz"        value="true"/>
        <arg name="publish_tf"  value="false"/>
    </include>

    <!-- Generate encoder data -->
    <node pkg="primo_gazebo" type="sim_wheel_encoders.py" name="encoder_sim"/>

    <!-- These let us control the sim robot with the joystick -->
    <include file="$(find primo_base)/launch/joy_twist.launch"/>
    <include file="$(find primo_base)/launch/vel_smooth.launch"/>

    <!-- Estop -->
    <node pkg="sound_play" type="soundplay_node.py" name="soundplay"/>
    <node pkg="primo_base" type="joy_estop" name="estop" output="screen"/>

    <include if="true" file="$(find primo_base)/launch/diff_drive.launch">
        <arg name="wheel_odom"  value="true"/>
        <arg name="publish_tf"  value="true"/>
        <arg name="PID"         value="false"/>
        <arg name="twist"       value="false"/>
        <arg name="odom_topic"  value="wheel/odom"/>
        <!-- <arg name="odom_topic"  value="odom"/> -->
    </include>

    <!-- Stereo Cam stuff -->
    <group if="true">
        <include file="$(find primo_stereo)/launch/stereo0.launch">
            <arg name="stereo_real" value="false"/>
        </include>

        <include file="$(find primo_stereo)/launch/stereo1.launch">
            <arg name="stereo_real" value="false"/>
        </include>

        <include file="$(find primo_rtabmap)/launch/rtab_master.launch">
            <arg name="slam"        value="true"/>
            <arg name="rtabmapviz"  value="false" />
            <arg name="stereo"      value="true" />
            <arg name="rgbd"        value="false" />
            <arg name="odom_topic"  value="odometry/filtered"/>
            
        </include>

        <include file="$(find primo_nav)/launch/primo_nav.launch"/>

    </group>

    <!-- Robot localization -->
    <node if="true" pkg="robot_localization" type="ekf_localization_node" name="ekf_se" clear_params="true">
        <rosparam command="load" file="$(find primo_base)/config/robot_localization.yaml" />

    </node>

</launch>
